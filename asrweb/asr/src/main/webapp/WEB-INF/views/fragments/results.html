<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="results" th:if="${results}">
    <div class="content-section-b">
        <div th:replace="fragments/help :: help"></div>
        <div class="row">
            <div id="heading">
                <h2><span class="node-label">Root</span> <small><span class="infer-label" th:text="*{inferenceType}"></span> reconstruction </small></h2>
                <hr class="h-divider"></hr>
            </div>
        </div>
        <div id="results" class="container-fluid" >
            <div class="row col-sm-10  col-sm-offset-1">
                <div id="reconstructed-tree" class="well col-sm-3" data-toggle="popover" data-placement="top" data-content="Annotated phylogenetic tree. Click on the internal nodes for ancestral reconstruction options: perform marginal inference or view joint reconstruction results.">
                    <svg id="phylo">
                            <script type="text/javascript" th:inline="javascript">
                                /*<![CDATA[*/
                                    var recon = /*[[${tree}]]*/;
                                    setup_tree("#phylo", recon);
                                   /*]]>*/
                            </script>
                    </svg>
                </div>
                <div class="col-sm-9">
                    <div class="btn-group" data-toggle="popover" data-placement="top" data-content="Change the colour scheme of the inferred character and representation of the distribution of characters in the sequence graphs.">
                        <button type="button" class="btn btn-default dropdown-toggle dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span id="selected-scheme">GRASP</span> | <small>Select other colour scheme...  </small><span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a id="random" onclick="update_scheme('random')">GRASP <span id="random-selected" class="glyph-selected glyphicon glyphicon-ok" aria-hidden="true"></span></a></li>
                            <li><a id="clustal" onclick="update_scheme('clustal')">Clustal <span id="clustal-selected" class="disable glyph-selected glyphicon glyphicon-ok" aria-hidden="true"></span></a></li>
                            <li><a id="lesk" onclick="update_scheme('lesk')">Lesk <span id="lesk-selected" class="disable glyph-selected glyphicon glyphicon-ok" aria-hidden="true"></span></a></li>
                            <li><a id="cinema" onclick="update_scheme('cinema')">Cinema <span id="cinema-selected" class="disable glyph-selected glyphicon glyphicon-ok" aria-hidden="true"></span></a></li>
                            <li><a id="ma" onclick="update_scheme('ma')">MAEditor <span id="ma-selected" class="disable glyph-selected glyphicon glyphicon-ok" aria-hidden="true"></span></a></li>
                        </ul>
                    </div>
                    <div id="poag" class="col-sm-12">
                        <div id="poag-popover" data-toggle="popover" data-placement="top" data-content="The sequence alignment graph (top), the inferred ancestor graph (bottom) and a positional window. Note that the window can be dragged to change the section of the graphs in view and the size of the positional window can be altered. Note: In the position window, indels are represented by a dot and regions of ambiguity based on multiple extant paths are shown as shaded regions."></div>
                    </div>
                        <script type="text/javascript" th:inline="javascript">
                                /*<![CDATA[*/
                                    var update_scheme = function(scheme) {
                                        var glyphs = document.querySelectorAll(".glyph-selected");
                                        for (var i = 0; i < glyphs.length; i++) {
                                            if (!glyphs[i].classList.contains('disable')) {
                                                glyphs[i].classList.add('disable');
                                            }
                                        }
                                        document.querySelector("#" + scheme + "-selected").classList.remove('disable');
                                        document.getElementById("selected-scheme").textContent = document.getElementById(scheme).textContent;
                                        update_colour(scheme);
                                    }

                                    var json_str = /*[[${graph}]]*/;
                                    var options = setup_options("poag", json_str);
                                    options = create_poags(options);
                                /*]]>*/
                        </script>
                </div>
            </div>
            <div class="row col-xs-10 col-xs-offset-1">
                <button id="download-toggle" class="btn btn-default col-xs-12" data-target="#download-form" data-toggle="collapse">Download Results...   <span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span></button>
                <div th:replace="fragments/download_form :: download_form"></div>
                <script type="text/javascript">
                    $('#download-toggle').click( function(){
                        $(this).find('span').toggleClass('glyphicon-menu-down').toggleClass('glyphicon-menu-up');
                        $(this).delay(500).queue(function() {
                            if ($("#help-btn").attr("aria-pressed") === 'true') {
                                if ($("#download-form").attr("aria-expanded") === 'true') {
                                    $('#download-form [data-toggle="popover"]').popover('show');
                                } else {
                                    $('#download-form [data-toggle="popover"]').popover('hide');
                                }
                            }
                            $(this).dequeue();
                        });
                    });
                </script>
            </div>
        </div>
    </div>
</div>
</body>
</html>